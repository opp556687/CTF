import subprocess
import os
import socket

# stage 1
path = './input'
argv = []
argv.append(path)
for i in range(99):
    argv.append('a')
argv[ord('A')] = ''
argv[ord('B')] = '\x20\x0a\x0d'
argv[ord('C')] = '9487'

# stage 2
r,w = os.pipe()
r_err, w_err = os.pipe()
os.write(w, b'\x00\x0a\x00\xff')
os.write(w_err, b'\x00\x0a\x02\xff')

# stage 3
envp = {b'\xde\xad\xbe\xef':b'\xca\xfe\xba\xbe'}

# stage 4
with open('\x0a', 'w') as f:
    f.write('\x00\x00\x00\x00')

# stage 5
subprocess.Popen(argv, stdin=r, stderr=r_err, env=envp)
s = socket.socket()
s.connect(('127.0.0.1', 9487))
s.send(b'\xde\xad\xbe\xef')
