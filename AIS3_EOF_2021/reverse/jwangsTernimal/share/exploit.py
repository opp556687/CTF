from Crypto.Cipher import AES
offset = 0

with open('./dump', 'rb') as f:
    while True:
        try:
            file_type = int.from_bytes(f.read(4), 'little')
            name_len = int.from_bytes(f.read(2), 'little')
            name = f.read(name_len)
            if file_type == 1:
                filesize = int.from_bytes(f.read(4), 'little')
                content = f.read(filesize)
                key = b'\xE9\x31\xDF\xC0\xC3\x7A\xEE\xAC\x6E\xC9\x87\x1C\x8A\x7A\xF6\xEC'
                iv = b'\xA1\xA4\xC4\x1C\x1C\x5B\xC5\x2E\x90\xDA\xB8\xFE\x46\x23\xBF\xBB'
                cryptor = AES.new(key=key, iv=iv, mode=AES.MODE_CBC)
                output = cryptor.encrypt(content).decode()
                if 'Flag' in output:
                    with open('./flag', 'w') as flag:
                        flag.write(output)
            else:
                f.read(4)
            f.read(4)
        except:
            exit(0)
